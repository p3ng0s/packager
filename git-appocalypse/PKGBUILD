pkgname=git-appocalypse-p3ng0s
pkgver=0.1
pkgrel=1
pkgdesc="git appcalypse for p3ng0s"
arch=("any")
options=('!strip' '!debug')
url="https://raw.githubusercontent.com/p3ng0s/archlive/refs/heads/main/archlive/airootfs/etc/skel/git_apocalypse.sh"
license=('NONE')
depends=('git' 'python')
source=("git_apocalypse.sh")
sha1sums=('SKIP')

build() {
	chmod +x git_apocalypse.sh
	./git_apocalypse.sh ${srcdir}
	cd $srcdir/opt/pentest/impacket
	python -m venv .
	./bin/pip install -U .
	cd $srcdir
}

package() {
	cp -ra $srcdir/* $pkgdir/
	# set the correct python interpreter
	find "${pkgdir}/opt/pentest/impacket/bin" -type f -executable -exec \
		sed -i "1s|#!.*python|#!/opt/pentest/impacket/bin/python|" {} +
	#SCRIPTS=( $(ls .) )
	#for script in ${SCRIPTS[*]}; do
	#	install -D -m755 ./$script $pkgdir/usr/local/bin/$script
	#done
}
